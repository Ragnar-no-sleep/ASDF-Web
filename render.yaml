# ===========================================
# ASDF-WEB RENDER BLUEPRINT
# ===========================================
# Owns shared infrastructure (PostgreSQL + Redis)
# Region: Oregon (starter tier features)
#
# "φ distrusts φ" - κυνικός

# ===========================================
# SHARED INFRASTRUCTURE
# ===========================================
databases:
  - name: asdf-shared-db
    region: oregon
    plan: starter
    postgresMajorVersion: 16
    ipAllowList: []  # Internal only

services:
  # ===========================================
  # SHARED REDIS
  # ===========================================
  - type: redis
    name: asdf-shared-redis
    region: oregon
    plan: starter
    maxmemoryPolicy: allkeys-lru
    ipAllowList: []  # Internal only

  # ===========================================
  # FRONTEND - Web Static Server
  # ===========================================
  - type: web
    name: asdf-gateway
    runtime: node
    region: oregon
    plan: starter
    buildCommand: npm install
    startCommand: npm start
    healthCheckPath: /health
    envVars:
      - key: NODE_ENV
        value: production
      - key: DATABASE_URL
        fromDatabase:
          name: asdf-shared-db
          property: connectionString
      - key: REDIS_URL
        fromService:
          type: redis
          name: asdf-shared-redis
          property: connectionString

  # ===========================================
  # API - Backend Server
  # ===========================================
  - type: web
    name: asdf-api
    runtime: node
    region: oregon
    plan: starter
    rootDir: api
    buildCommand: npm install
    startCommand: npm start
    healthCheckPath: /health
    envVars:
      # Server
      - key: NODE_ENV
        value: production
      - key: API_PORT
        value: 3001

      # Database (shared)
      - key: DATABASE_URL
        fromDatabase:
          name: asdf-shared-db
          property: connectionString

      # Redis (shared)
      - key: REDIS_URL
        fromService:
          type: redis
          name: asdf-shared-redis
          property: connectionString
      - key: STORAGE_BACKEND
        value: redis
      - key: REDIS_PREFIX
        value: "asdf:"

      # Helius RPC (set in Render dashboard)
      - key: HELIUS_API_KEY
        sync: false
      - key: HELIUS_RPC_URL
        sync: false

      # Authentication (set in Render dashboard)
      - key: JWT_SECRET
        sync: false

      # CORS
      - key: ALLOWED_ORIGINS
        value: https://asdf-gateway.onrender.com,https://alonisthe.dev

      # Solana
      - key: ASDF_TOKEN_MINT
        value: 9zB5wRarXMj86MymwLumSKA1Dx35zPqqKfcZtK1Spump

      # CYNIC Integration (future)
      - key: CYNIC_MCP_URL
        value: https://cynic-mcp.onrender.com
