# ASDF-Web Pre-Commit Hook
# Philosophy: Don't trust. Verify.
# Sans lint-staged (cause des bugs index.lock sur Windows)

echo "ğŸ” Running pre-commit checks..."

# Get staged files
STAGED_JS=$(git diff --cached --name-only --diff-filter=ACM | grep -E '\.(js|jsx|ts|tsx)$' || true)
STAGED_OTHER=$(git diff --cached --name-only --diff-filter=ACM | grep -E '\.(json|md|css)$' || true)

# ESLint + Prettier on JS files
if [ -n "$STAGED_JS" ]; then
  echo "ğŸ“ Checking JS/TS files..."
  npx eslint $STAGED_JS --fix --quiet 2>/dev/null || true
  npx prettier --write $STAGED_JS 2>/dev/null || true
  git add $STAGED_JS 2>/dev/null || true
fi

# Prettier on other files
if [ -n "$STAGED_OTHER" ]; then
  echo "âœ¨ Formatting other files..."
  npx prettier --write $STAGED_OTHER 2>/dev/null || true
  git add $STAGED_OTHER 2>/dev/null || true
fi

echo "âœ… Pre-commit checks passed"
echo "This is fine. ğŸ•â€ğŸ¦ºğŸ”¥"
